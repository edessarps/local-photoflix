          <!-- const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz208pvfUdkeiUpbwlqJkWwEHYVYUJV6RA58TYISD4ZRPMFrysEpyhgSIGuCMX8l3yleg/exec"; // N'oubliez pas de remettre votre URL !-->
<!DOCTYPE html>
<html lang="fr" class="bg-gray-900">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photoflix</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <script type="text/javascript" src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #141414; color: #e5e5e5; }
        .album-row::-webkit-scrollbar, .film-row::-webkit-scrollbar { display: none; }
        .album-row, .film-row { -ms-overflow-style: none; scrollbar-width: none; }
        .item-card { transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .item-card:hover { transform: scale(1.05); z-index: 10; box-shadow: 0 10px 20px rgba(0,0,0,0.7); }
        .nav-link { transition: color 0.2s; }
        .nav-link.active { color: #e50914; font-weight: bold; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #e50914; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        google-cast-launcher { width: 24px; height: 24px; cursor: pointer; }
    </style>
</head>
<body class="text-white">

    <header class="fixed top-0 left-0 right-0 bg-gradient-to-b from-black to-transparent p-4 z-50 transition-all duration-300" id="main-header">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-8">
                <h1 class="text-3xl font-bold text-red-600 tracking-wider">PHOTOFLIX</h1>
                <nav class="hidden md:flex items-center space-x-6 text-lg">
                    <a href="#" id="nav-photos" class="nav-link active" onclick="switchView('photos')">Photos</a>
                    <a href="#" id="nav-films" class="nav-link" onclick="switchView('films')">Films</a>
                </nav>
            </div>
            <div class="flex items-center space-x-6">
                <google-cast-launcher class="text-2xl"></google-cast-launcher>
                <div class="w-8 h-8 bg-blue-500 rounded-md"></div>
            </div>
        </div>
    </header>

    <main id="main-content">
        <section id="hero-section" class="h-screen/2 lg:h-[75vh] bg-cover bg-center flex items-end p-8 lg:p-16 text-white shadow-lg relative">
             <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent"></div>
            <div class="z-10 relative"><h2 id="hero-title" class="text-4xl lg:text-6xl font-black mb-4 max-w-2xl"></h2><p id="hero-summary" class="text-lg mb-6 max-w-2xl"></p><button id="hero-play-btn" class="bg-white text-black px-8 py-3 rounded-md font-bold text-lg hover:bg-gray-200 transition-colors flex items-center gap-2"><i class="fas fa-play"></i> Lancer</button></div>
        </section>

        <div id="photos-view" class="container mx-auto px-4 lg:px-8 py-8 space-y-12"></div>
        <div id="films-view" class="container mx-auto px-4 lg:px-8 py-8 space-y-12 hidden"></div>
    </main>

    <div id="details-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] hidden"></div>
    <div id="player-overlay" class="fixed inset-0 z-[70] hidden flex items-center justify-center bg-black"></div>
    <div id="cast-remote-overlay" class="fixed bottom-0 left-0 right-0 bg-gray-800 p-4 z-[80] hidden items-center justify-between shadow-lg"></div>

    <script>
        // --- CONFIGURATION ---
        const SCRIPT_URL_BASE = "https://script.google.com/macros/s/AKfycbz208pvfUdkeiUpbwlqJkWwEHYVYUJV6RA58TYISD4ZRPMFrysEpyhgSIGuCMX8l3yleg/exec"; // Remplacez par votre URL de script
        const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=`;

        // --- STATE ---
        let photosData = {};
        let filmsData = {};
        let currentView = 'photos';
        let currentContent = {};
        let currentIndex = 0;
        let slideshowInterval;
        let isPlaying = true;

        // --- ELEMENTS ---
        const photosView = document.getElementById('photos-view');
        const filmsView = document.getElementById('films-view');
        const modalContainer = document.getElementById('details-modal');
        const playerOverlay = document.getElementById('player-overlay');
        
        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            loadPhotos();
            setupHeaderScroll();
            setupKeyboardControls();
        });

        function showError(message, viewElement) {
            let advice = "Veuillez vérifier votre connexion internet et l'URL de votre script Google.";
            if (message.includes("Impossible de lire le fichier")) {
                advice = "L'erreur vient de votre script Google. Assurez-vous que les fichiers 'photos.json' et 'films.json' existent dans les bons dossiers ('PHOTOS' et 'FILM') et que leur contenu est un JSON valide.";
            } else if (message.includes("introuvable")) {
                advice = "Un dossier est introuvable sur votre Google Drive. Vérifiez que les noms des dossiers ('PHOTOFLIX', 'PHOTOS', 'FILM') sont corrects dans le script.";
            }
            viewElement.innerHTML = `<div class="text-center text-red-500 max-w-2xl mx-auto"><h2 class="text-2xl font-bold mb-2">Erreur de chargement</h2><p class="bg-gray-800 p-3 rounded-md text-left text-sm font-mono">${message}</p><p class="mt-4 text-base text-gray-300">${advice}</p></div>`;
        }

        async function fetchData(section) {
            const view = document.getElementById(`${section}-view`);
            view.innerHTML = '<div class="w-full flex justify-center"><div class="loader"></div></div>';
            try {
                const response = await fetch(`${SCRIPT_URL_BASE}?section=${section}`);
                if (!response.ok) throw new Error(`Erreur réseau (status: ${response.status})`);
                const data = await response.json();
                if (data.error) throw new Error(data.error);
                return data;
            } catch (error) {
                console.error(`Impossible de charger la section ${section}:`, error);
                showError(error.message, view);
                return null;
            }
        }

        async function loadPhotos() {
            const data = await fetchData('photos');
            if (data) {
                photosData = data;
                populatePhotos();
                setupHero(Object.keys(photosData)[0], 'photos');
            }
        }

        async function loadFilms() {
            const data = await fetchData('films');
            if (data) {
                filmsView.innerHTML = '<div class="w-full flex justify-center"><div class="loader"></div></div>';
                const enrichedData = {};
                for (const id in data) {
                    const film = data[id];
                    const geminiData = await getGeminiFilmInfo(film.title);
                    enrichedData[id] = { ...film, ...geminiData };
                }
                filmsData = enrichedData;
                populateFilms();
            }
        }
        
        async function getGeminiFilmInfo(title) {
            const prompt = `Fournis les informations pour le film "${title}" au format JSON : un résumé court (summary), l'année de sortie (year), les 3 acteurs principaux (actors), le réalisateur (director), le genre (genre), et une URL HTTPS valide vers une affiche du film de bonne qualité (posterUrl). Si le film est introuvable, retourne des champs vides.`;
            try {
                const payload = {
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: { 
                        responseMimeType: "application/json", 
                        responseSchema: { 
                            type: "OBJECT", 
                            properties: { 
                                summary: { "type": "STRING" }, year: { "type": "NUMBER" }, 
                                actors: { "type": "ARRAY", "items": { "type": "STRING" } }, 
                                director: { "type": "STRING" }, genre: { "type": "STRING" },
                                posterUrl: { "type": "STRING" }
                            } 
                        } 
                    }
                };
                const response = await fetch(GEMINI_API_URL, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) return {};
                const result = await response.json();
                const jsonText = result.candidates[0].content.parts[0].text;
                return JSON.parse(jsonText);
            } catch (error) {
                console.error("Erreur Gemini:", error);
                return {};
            }
        }

        function switchView(view) {
            currentView = view;
            document.getElementById('nav-photos').classList.toggle('active', view === 'photos');
            document.getElementById('nav-films').classList.toggle('active', view === 'films');
            photosView.classList.toggle('hidden', view !== 'photos');
            filmsView.classList.toggle('hidden', view !== 'films');
            if (view === 'films' && Object.keys(filmsData).length === 0) loadFilms();
            const data = view === 'photos' ? photosData : filmsData;
            const firstId = Object.keys(data)[0];
            if(firstId) setupHero(firstId, view);
        }

        function populatePhotos() {
            photosView.innerHTML = '';
            const categories = [...new Set(Object.values(photosData).map(a => a.category))];
            categories.forEach(category => {
                const row = document.createElement('div');
                row.innerHTML = `<h2 class="text-2xl font-bold mb-4">${category}</h2><div class="flex overflow-x-auto space-x-4 pb-4 album-row"></div>`;
                const container = row.querySelector('.album-row');
                Object.entries(photosData).forEach(([id, data]) => {
                    if (data.category === category) {
                        const card = document.createElement('div');
                        card.className = 'flex-shrink-0 w-64 h-36 bg-gray-700 rounded-lg overflow-hidden cursor-pointer item-card';
                        card.innerHTML = `<img src="${data.images[0]}" alt="${data.title}" class="w-full h-full object-cover">`;
                        card.onclick = () => openModal(id, 'photos');
                        container.appendChild(card);
                    }
                });
                photosView.appendChild(row);
            });
        }
        
        function populateFilms() {
            filmsView.innerHTML = '';
            const row = document.createElement('div');
            row.innerHTML = `<h2 class="text-2xl font-bold mb-4">Tous les films</h2><div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4"></div>`;
            const container = row.querySelector('.grid');
            Object.entries(filmsData).forEach(([id, data]) => {
                const card = document.createElement('div');
                card.className = 'aspect-[2/3] bg-gray-800 rounded-lg overflow-hidden cursor-pointer item-card';
                const placeholder = `https://placehold.co/400x600/1f2937/ffffff?text=${encodeURIComponent(data.title)}`;
                card.innerHTML = `<img src="${data.posterUrl || placeholder}" alt="${data.title}" class="w-full h-full object-cover">`;
                card.onclick = () => openModal(id, 'films');
                container.appendChild(card);
            });
            filmsView.appendChild(row);
        }

        function setupHero(id, type) {
            const data = (type === 'photos' ? photosData[id] : filmsData[id]);
            if (!data) return;
            const backgroundImageUrl = type === 'photos' ? (data.images[1] || data.images[0]) : data.posterUrl;
            document.getElementById('hero-section').style.backgroundImage = backgroundImageUrl ? `url('${backgroundImageUrl}')` : '';
            document.getElementById('hero-section').style.backgroundColor = backgroundImageUrl ? '' : '#222';
            document.getElementById('hero-title').textContent = data.title;
            document.getElementById('hero-summary').textContent = data.summary ? data.summary.substring(0, 150) + '...' : '';
            document.getElementById('hero-play-btn').onclick = () => playContent(id, type);
        }

        function openModal(id, type) {
            const data = (type === 'photos' ? photosData[id] : filmsData[id]);
            let modalHTML = '';
            if (type === 'photos') {
                modalHTML = `<div class="bg-gray-800 rounded-lg max-w-3xl w-11/12 mx-auto overflow-hidden"><div class="relative"><img src="${data.images[0]}" class="w-full h-96 object-cover"><div class="absolute inset-0 bg-gradient-to-t from-gray-800"></div><button onclick="closeModal()" class="absolute top-4 right-4 text-white bg-gray-900 rounded-full w-8 h-8">&times;</button><h3 class="absolute bottom-0 p-8 text-4xl font-bold">${data.title}</h3></div><div class="p-8"><div class="flex items-center space-x-4 mb-4 text-lg"><span class="font-semibold text-gray-300">${data.year}</span></div><p class="mb-4">${data.summary}</p><p class="text-gray-400"><strong>Avec :</strong> ${data.people}</p><button onclick="playFromModal('${id}', 'photos')" class="mt-6 bg-red-600 px-8 py-3 rounded-md font-bold text-lg">Lancer</button></div></div>`;
            } else {
                const placeholder = `https://placehold.co/800x450/1f2937/ffffff?text=${encodeURIComponent(data.title)}`;
                modalHTML = `<div class="bg-gray-800 rounded-lg max-w-3xl w-11/12 mx-auto overflow-hidden"><div class="relative"><img src="${data.posterUrl || placeholder}" class="w-full h-96 object-cover"><div class="absolute inset-0 bg-gradient-to-t from-gray-800"></div><button onclick="closeModal()" class="absolute top-4 right-4 text-white bg-gray-900 rounded-full w-8 h-8">&times;</button><h3 class="absolute bottom-0 p-8 text-4xl font-bold">${data.title}</h3></div><div class="p-8"><div class="flex items-center space-x-4 mb-4 text-lg"><span class="font-semibold text-gray-300">${data.year || ''}</span><span class="text-gray-400">${data.genre || ''}</span></div><p class="mb-4">${data.summary || 'Résumé non disponible.'}</p><p class="text-gray-400"><strong>Avec :</strong> ${data.actors ? data.actors.join(', ') : 'N/A'}</p><p class="text-gray-400 mt-2"><strong>Réalisateur :</strong> ${data.director || 'N/A'}</p><button onclick="playFromModal('${id}', 'films')" class="mt-6 bg-red-600 px-8 py-3 rounded-md font-bold text-lg">Lancer</button></div></div>`;
            }
            modalContainer.innerHTML = modalHTML;
            modalContainer.classList.remove('hidden');
        }
        
        function playFromModal(id, type) { closeModal(); playContent(id, type); }
        function closeModal() { modalContainer.classList.add('hidden'); modalContainer.innerHTML = ''; }
        function playContent(id, type) { currentContent = { id, type, data: (type === 'photos' ? photosData[id] : filmsData[id]) }; if (isCasting()) castContent(); else if (type === 'photos') localSlideshow(); else if (type === 'films') localVideoPlayer(); }
        function localSlideshow() { currentIndex = 0; isPlaying = true; playerOverlay.innerHTML = `<img id="slideshow-image" src="" class="max-h-full max-w-full object-contain"><button onclick="closePlayer()" class="absolute top-5 right-5 text-white text-4xl">&times;</button><div class="absolute bottom-5 left-1/2 -translate-x-1/2 bg-black bg-opacity-50 p-4 rounded-lg flex items-center space-x-6 text-2xl"><button onclick="prevImage()" class="text-white"><i class="fas fa-backward-step"></i></button><button id="play-pause-btn" onclick="togglePlayPause()" class="text-white"><i class="fas fa-pause"></i></button><button onclick="nextImage()" class="text-white"><i class="fas fa-forward-step"></i></button></div>`; updateSlideshowImage(); playerOverlay.classList.remove('hidden'); resetInterval(); }
        function localVideoPlayer() { playerOverlay.innerHTML = `<video src="${currentContent.data.videoUrl}" controls autoplay class="w-full h-full"></video><button onclick="closePlayer()" class="absolute top-5 right-5 text-white text-4xl bg-black bg-opacity-50 rounded-full w-12 h-12">&times;</button>`; playerOverlay.classList.remove('hidden'); }
        function closePlayer() { playerOverlay.classList.add('hidden'); playerOverlay.innerHTML = ''; clearInterval(slideshowInterval); }
        function updateSlideshowImage() { const img = document.getElementById('slideshow-image'); if(img) img.src = currentContent.data.images[currentIndex]; }
        function nextImage() { currentIndex = (currentIndex + 1) % currentContent.data.images.length; updateSlideshowImage(); if (isPlaying) resetInterval(); }
        function prevImage() { currentIndex = (currentIndex - 1 + currentContent.data.images.length) % currentContent.data.images.length; updateSlideshowImage(); if (isPlaying) resetInterval(); }
        function togglePlayPause() { isPlaying = !isPlaying; document.getElementById('play-pause-btn').querySelector('i').className = isPlaying ? 'fas fa-pause' : 'fas fa-play'; if (isPlaying) resetInterval(); else clearInterval(slideshowInterval); }
        function resetInterval() { clearInterval(slideshowInterval); if(isPlaying) slideshowInterval = setInterval(nextImage, 3000); }
        function castContent() { /* ... Cast logic ... */ }
        function setupHeaderScroll() { window.addEventListener('scroll', () => { document.getElementById('main-header').style.backgroundColor = window.scrollY > 50 ? '#141414' : 'transparent'; }); }
        function setupKeyboardControls() { document.addEventListener('keydown', (e) => { if (playerOverlay.classList.contains('hidden')) return; if (currentContent.type === 'photos') { if (e.key === 'ArrowRight') nextImage(); if (e.key === 'ArrowLeft') prevImage(); if (e.key === ' ') { e.preventDefault(); togglePlayPause(); } } if (e.key === 'Escape') closePlayer(); }); }
        window['__onGCastApiAvailable'] = (isAvailable) => { if (isAvailable) initializeCastApi(); };
        function initializeCastApi() { cast.framework.CastContext.getInstance().setOptions({ receiverApplicationId: chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID, autoJoinPolicy: chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED }); }
    </script>
</body>
</html>
